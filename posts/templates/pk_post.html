{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–ª–æ–≥ –≥—Ä—É–ø–ø—ã PyE-242</title>
    <link rel="stylesheet" href="{% static 'css/posts2.css' %}">
    <script src="{% static 'js/likes3.js' %}"></script>
</head>
<body>
    <header>
        <h1>–ë–ª–æ–≥ –≥—Ä—É–ø–ø—ã <span class="group-name">PyE-242</span></h1>
    </header>

    <div class="main-wrapper">
        <main class="container">
            {% if post %}
                <div class="post">
                    <h2 class="post-title">{{ post.title }}</h2>
                    <div class="post-meta">
                        –ê–≤—Ç–æ—Ä: {{ post.user.username }} |
                        –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ post.data_publication|date:"d.m.Y H:i" }}
                    </div>
                    <div class="post-categories">
                        {% for category in post.categories.all %}
                            <span class="category">{{ category.title }}</span>
                        {% endfor %}
                    </div>
                    <div class="post-description">{{ post.description }}</div>
                    <div class="post-images">
                        {% for image in post.post_images.all %}
                            <img src="{{ image.image.url }}" alt="image" class="post-image">
                        {% endfor %}
                    </div>
                    <div class="post-reactions">
                        <button onclick="likePost('{{ post.pk }}')" 
                                id="likeButton{{ post.pk }}"
                                class="like {% if request.user in post.users_liked.all %}active{% endif %}"
                                {% if not request.user.is_authenticated %}disabled{% endif %}>
                            üëç <span class="count">{{ post.likes }}</span>
                        </button>
                        <button onclick="dislikePost('{{ post.pk }}')" 
                                id="dislikeButton{{ post.pk }}"
                                class="dislike {% if request.user in post.users_disliked.all %}active{% endif %}"
                                {% if not request.user.is_authenticated %}disabled{% endif %}>
                            üëé <span class="count">{{ post.dislikes }}</span>
                        </button>
                    </div>
                </p>
                    {% if request.user == post.user %}
                    <div class="form-delete">
                        <form action="{% url 'delete_post' post.pk %}" method="post">
                            {% csrf_token %}
                            <input type="submit" value="–£–¥–∞–ª–∏—Ç—å" class="btn-submit">
                        </form>
                    </div>
                    {% endif %}
                 </p>
                    {% if request.user == post.user %}
                    <div class="form-edit">
                        <form action="{% url 'edit_post' post.pk %}" method="post">
                            {% csrf_token %}
                            <input type="submit" value="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" class="btn-edit">
                        </form>
                    </div>
                    {% endif %}

                
                </div>

                <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
                <div class="comments-section">
                    <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>

                    {% if post.post_comments.all %}
                        <div class="comments-list">
                            {% for comment in post.post_comments.all %}
                                {% if not comment.parent %}
                                    {% include "comments.html" with comment=comment post=post level=0 %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å –ø–µ—Ä–≤—ã–º!</p>
                    {% endif %}
                </div>

                <!-- –§–æ—Ä–º–∞ –Ω–æ–≤–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                <div class="new-comment-form">
                    <h4>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
                    <form action="{% url 'comments' post.id %}" method="post">
                        {% csrf_token %}
                        <textarea name="text" rows="4" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </form>
                </div>
            {% else %}
                <p>–ü–æ—Å—Ç–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>
            {% endif %}
        </main>
    </div>
</body>
</html>